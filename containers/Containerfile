FROM registry.fedoraproject.org/fedora-toolbox:34

MAINTAINER "Candlepin Team" <candlepin@redhat.com>

ENV SMDEV_CONTAINER_OFF='True'

RUN yum install --disablerepo=updates -y \
    gettext \
    git \
    jss \
    openssl \
    bind-utils \
    dbus-glib \
    dbus-glib-devel \
    dnf-utils \
    gcc \
    git \
    postfix \
    python3-pip \
    sudo \
    vim \
    wget \
    zsh \
    cmake \
    dbus-daemon \
    desktop-file-utils \
    GConf2-devel \
    gtk3-devel \
    intltool \
    json-c-devel \
    libdnf-devel \
    libnotify-devel \
    make \
    openssl-devel \
    rarian-compat \
    rpmlint \
    rpm-build \
    xorg-x11-server-Xvfb \
    # zanata-client \
    python3-devel \
    python3-decorator \
    python3-six \
    python3-dateutil \
    python3-iniparse \
    python3-nose \
    python3-coverage \
    python3-polib \
    python3-decorator \
    python3-inotify \
    python3-simplejson \
    python3-sphinx \
    # python3-unittest2 \
    python3-rpm \
    python3-gobject-base \
    python3-ethtool \
    redhat-rpm-config \
    subscription-manager-rhsm-certificates \
    python3-virtualenv \
    glibc-common \
    langpacks-as \
    langpacks-bn \
    langpacks-de \
    langpacks-es \
    langpacks-fr \
    langpacks-gu \
    langpacks-hi \
    langpacks-it \
    langpacks-ja \
    langpacks-kn \
    langpacks-ko \
    langpacks-ml \
    langpacks-mr \
    langpacks-or \
    langpacks-pa \
    langpacks-pt_BR \
    langpacks-ru \
    langpacks-ta \
    langpacks-te \
    langpacks-zh_CN \
    langpacks-zh_TW \
    && yum clean all

RUN mkdir /build
COPY requirements.txt dev-requirements.txt /build
WORKDIR /build
RUN pip3 install -r dev-requirements.txt
RUN git clone https://github.com/candlepin/subscription-manager.git
WORKDIR /build/subscription-manager
RUN python3 ./setup.py build
RUN python3 ./setup.py build_ext --inplace
RUN yum-builddep -y ./subscription-manager.spec
RUN echo "export SMDEV_CONTAINER_OFF='True'" >> /root/.bashrc && echo "export SMDEV_CONTAINER_OFF='True'" >> /root/.zshrc
